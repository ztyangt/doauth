import{b as F,s as ae,d as E,P as G,o as c,f as V,n as d,h as e,r as N,m as C,g as y,p as M,_ as O,a5 as P,t as U,a0 as K,ae as Q,af as X,ag as te,G as W,Q as le,J as Y,i as re,z as B,a as oe,I as ne,ah as ie,c as S,a3 as j,k as $,w as u,l as ue,E as L,j as t,ai as pe,aj as de,ak as ce,a2 as me,al as q,a6 as R,am as fe,a9 as ve,aa as ge,ab as _e,ac as be,ad as he}from"./index-87345e05.js";import{_ as we,E as ye,a as Se}from"./LottieItem-66b861e3.js";const ke=F({header:{type:String,default:""},bodyStyle:{type:ae([String,Object,Array]),default:""},shadow:{type:String,values:["always","hover","never"],default:"always"}}),Ve=E({name:"ElCard"}),$e=E({...Ve,props:ke,setup(w){const f=G("card");return(s,v)=>(c(),V("div",{class:d([e(f).b(),e(f).is(`${s.shadow}-shadow`)])},[s.$slots.header||s.header?(c(),V("div",{key:0,class:d(e(f).e("header"))},[N(s.$slots,"header",{},()=>[P(U(s.header),1)])],2)):C("v-if",!0),y("div",{class:d(e(f).e("body")),style:M(s.bodyStyle)},[N(s.$slots,"default")],6)],2))}});var xe=O($e,[["__file","/home/runner/work/element-plus/element-plus/packages/components/card/src/card.vue"]]);const Ce=K(xe),Ee=F({space:{type:[Number,String],default:""},active:{type:Number,default:0},direction:{type:String,default:"horizontal",values:["horizontal","vertical"]},alignCenter:{type:Boolean},simple:{type:Boolean},finishStatus:{type:String,values:["wait","process","finish","error","success"],default:"finish"},processStatus:{type:String,values:["wait","process","finish","error","success"],default:"process"}}),Ie={[Q]:(w,f)=>[w,f].every(X)},Ne=E({name:"ElSteps"}),qe=E({...Ne,props:Ee,emits:Ie,setup(w,{emit:f}){const s=w,v=G("steps"),{children:o,addChild:n,removeChild:a}=te(Y(),"ElStep");return W(o,()=>{o.value.forEach((g,_)=>{g.setIndex(_)})}),le("ElSteps",{props:s,steps:o,addStep:n,removeStep:a}),W(()=>s.active,(g,_)=>{f(Q,g,_)}),(g,_)=>(c(),V("div",{class:d([e(v).b(),e(v).m(g.simple?"simple":g.direction)])},[N(g.$slots,"default")],2))}});var Ue=O(qe,[["__file","/home/runner/work/element-plus/element-plus/packages/components/steps/src/steps.vue"]]);const Be=F({title:{type:String,default:""},icon:{type:re},description:{type:String,default:""},status:{type:String,values:["","wait","process","finish","error","success"],default:""}}),Pe=E({name:"ElStep"}),ze=E({...Pe,props:Be,setup(w){const f=w,s=G("step"),v=B(-1),o=B({}),n=B(""),a=oe("ElSteps"),g=Y();ne(()=>{W([()=>a.props.active,()=>a.props.processStatus,()=>a.props.finishStatus],([r])=>{i(r)},{immediate:!0})}),ie(()=>{a.removeStep(H.uid)});const _=S(()=>f.status||n.value),x=S(()=>{const r=a.steps.value[v.value-1];return r?r.currentStatus:"wait"}),b=S(()=>a.props.alignCenter),l=S(()=>a.props.direction==="vertical"),m=S(()=>a.props.simple),k=S(()=>a.steps.value.length),z=S(()=>{var r;return((r=a.steps.value[k.value-1])==null?void 0:r.uid)===(g==null?void 0:g.uid)}),p=S(()=>m.value?"":a.props.space),h=S(()=>[s.b(),s.is(m.value?"simple":a.props.direction),s.is("flex",z.value&&!p.value&&!b.value),s.is("center",b.value&&!l.value&&!m.value)]),A=S(()=>{const r={flexBasis:X(p.value)?`${p.value}px`:p.value?p.value:`${100/(k.value-(b.value?0:1))}%`};return l.value||z.value&&(r.maxWidth=`${100/k.value}%`),r}),D=r=>{v.value=r},T=r=>{const I=r==="wait",Z={transitionDelay:`${I?"-":""}${150*v.value}ms`},J=r===a.props.processStatus||I?0:100;Z.borderWidth=J&&!m.value?"1px":0,Z[a.props.direction==="vertical"?"height":"width"]=`${J}%`,o.value=Z},i=r=>{r>v.value?n.value=a.props.finishStatus:r===v.value&&x.value!=="error"?n.value=a.props.processStatus:n.value="wait";const I=a.steps.value[v.value-1];I&&I.calcProgress(n.value)},H=j({uid:g.uid,currentStatus:_,setIndex:D,calcProgress:T});return a.addStep(H),(r,I)=>(c(),V("div",{style:M(e(A)),class:d(e(h))},[C(" icon & line "),y("div",{class:d([e(s).e("head"),e(s).is(e(_))])},[e(m)?C("v-if",!0):(c(),V("div",{key:0,class:d(e(s).e("line"))},[y("i",{class:d(e(s).e("line-inner")),style:M(o.value)},null,6)],2)),y("div",{class:d([e(s).e("icon"),e(s).is(r.icon||r.$slots.icon?"icon":"text")])},[N(r.$slots,"icon",{},()=>[r.icon?(c(),$(e(L),{key:0,class:d(e(s).e("icon-inner"))},{default:u(()=>[(c(),$(ue(r.icon)))]),_:1},8,["class"])):e(_)==="success"?(c(),$(e(L),{key:1,class:d([e(s).e("icon-inner"),e(s).is("status")])},{default:u(()=>[t(e(pe))]),_:1},8,["class"])):e(_)==="error"?(c(),$(e(L),{key:2,class:d([e(s).e("icon-inner"),e(s).is("status")])},{default:u(()=>[t(e(de))]),_:1},8,["class"])):e(m)?C("v-if",!0):(c(),V("div",{key:3,class:d(e(s).e("icon-inner"))},U(v.value+1),3))])],2)],2),C(" title & description "),y("div",{class:d(e(s).e("main"))},[y("div",{class:d([e(s).e("title"),e(s).is(e(_))])},[N(r.$slots,"title",{},()=>[P(U(r.title),1)])],2),e(m)?(c(),V("div",{key:0,class:d(e(s).e("arrow"))},null,2)):(c(),V("div",{key:1,class:d([e(s).e("description"),e(s).is(e(_))])},[N(r.$slots,"description",{},()=>[P(U(r.description),1)])],2))],2)],6))}});var ee=O(ze,[["__file","/home/runner/work/element-plus/element-plus/packages/components/steps/src/item.vue"]]);const Ae=K(Ue,{Step:ee}),De=ce(ee);const se=w=>(_e("data-v-1bd4b242"),w=w(),be(),w),Re={class:"card-header flex-center"},je=se(()=>y("h1",{class:"center"},"DoAuth域名授权管理系统",-1)),Te={key:2,class:"install-success center my-4"},Ze=se(()=>y("div",{class:"w-100 center"},[y("span",null,"恭喜您，程序已安装成功！")],-1)),Le={class:"flex-center px-4"},Me=E({__name:"index",setup(w){const f=B(),s=B(),v=me(),o=j({hostname:"localhost",hostport:"3306",database:"",username:"",password:"",prefix:"auth"}),n=j({account:"admin",nickname:"管理员",email:"",password:"",re_password:""}),a=j({step:0}),g={hostname:[{required:!0,message:"数据库地址不能为空",trigger:"blur"}],hostport:[{required:!0,message:"数据库端口不能为空",trigger:"blur"}],database:[{required:!0,message:"数据库名称不能为空",trigger:"blur"}],username:[{required:!0,message:"数据库用户名不能为空",trigger:"blur"}],password:[{required:!0,message:"数据库密码不能为空",trigger:"blur"},{min:6,message:"数据库密码不能少于6位",trigger:"blur"},{max:18,message:"数据库密码不能多于18位",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"数据库密码只能包含数字字母或下划线",trigger:"blur"}],prefix:[{required:!0,message:"数据表前缀不能为空",trigger:"blur"},{pattern:/^[a-zA-Z]+$/,message:"数据表前缀只可以输入数字母",trigger:"blur"}]},_={account:[{required:!0,message:"账户名不能为空",trigger:"blur"},{min:5,message:"账户名不能少于5位",trigger:"blur"},{max:18,message:"账户名不能多于18位",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"账户名只能包含数字字母或下划线",trigger:"blur"}],nickname:[{required:!0,message:"昵称不能为空",trigger:"blur"}],email:[{required:!0,message:"邮箱不能为空",trigger:"blur"},{pattern:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,message:"邮箱格式不正确",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"},{min:6,message:"密码不能少于6位",trigger:"blur"},{max:18,message:"密码不能多于18位",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"密码只能包含数字字母或下划线",trigger:"blur"}]},x={handleNext:async()=>{a.step===0&&x.initDB(f.value),a.step===1&&x.install(s.value),a.step===3&&v.push("/")},initDB:async b=>{b&&await b.validate(async l=>{if(l){const m=await q.connect(o.hostname,o.hostport,o.database,o.username,o.password,o.prefix);if(R(m),m.code===200){const k=await q.init();R(k),a.step=1}}})},install:async b=>{b&&await b.validate(async l=>{if(l){if(n.password!==n.re_password)return fe.warning("两次输入的密码不一致，请检查！");const m=await q.admin(n.account,n.nickname,n.email,n.password);R(m),m.code===200&&x.installLock()}})},installLock:async()=>{const b=await q.lock();R(b,"安装成功"),b.code===200&&(a.step=3)},goPrev:async()=>{await q.rmconfig(),a.step=0}};return(b,l)=>{const m=we,k=De,z=Ae,p=ve,h=ye,A=Se,D=ge,T=Ce;return c(),$(T,{class:"box-card p-2"},{header:u(()=>[y("div",Re,[t(m,{name:"auth",width:"80px",height:"80px"}),je])]),default:u(()=>[t(z,{active:e(a).step,"finish-status":"success","align-center":""},{default:u(()=>[t(k,{title:"数据库配置"}),t(k,{title:"管理员账户"}),t(k,{title:"完成安装"})]),_:1},8,["active"]),e(a).step===0?(c(),$(A,{key:0,ref_key:"dbRef",ref:f,model:e(o),rules:g,"label-width":"110px",class:"mt-4","label-position":"right","require-asterisk-position":"right"},{default:u(()=>[t(h,{label:"数据库地址",prop:"hostname"},{default:u(()=>[t(p,{modelValue:e(o).hostname,"onUpdate:modelValue":l[0]||(l[0]=i=>e(o).hostname=i),placeholder:"请输入数据库地址",clearable:""},null,8,["modelValue"])]),_:1}),t(h,{label:"数据库端口",prop:"hostport"},{default:u(()=>[t(p,{modelValue:e(o).hostport,"onUpdate:modelValue":l[1]||(l[1]=i=>e(o).hostport=i),placeholder:"请输入数据库端口号",clearable:""},null,8,["modelValue"])]),_:1}),t(h,{label:"数据库名称",prop:"database"},{default:u(()=>[t(p,{modelValue:e(o).database,"onUpdate:modelValue":l[2]||(l[2]=i=>e(o).database=i),placeholder:"请输入数据库名称",clearable:""},null,8,["modelValue"])]),_:1}),t(h,{label:"数据库用户名",prop:"username"},{default:u(()=>[t(p,{modelValue:e(o).username,"onUpdate:modelValue":l[3]||(l[3]=i=>e(o).username=i),placeholder:"请输入数据库用户名",clearable:""},null,8,["modelValue"])]),_:1}),t(h,{label:"数据库密码",prop:"password"},{default:u(()=>[t(p,{modelValue:e(o).password,"onUpdate:modelValue":l[4]||(l[4]=i=>e(o).password=i),type:"password",placeholder:"请输入数据库密码",clearable:"","show-password":""},null,8,["modelValue"])]),_:1}),t(h,{label:"数据表前缀",prop:"prefix"},{default:u(()=>[t(p,{modelValue:e(o).prefix,"onUpdate:modelValue":l[5]||(l[5]=i=>e(o).prefix=i),placeholder:"请输入数据表前缀",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):e(a).step===1?(c(),$(A,{key:1,ref_key:"adminRef",ref:s,model:e(n),rules:_,"label-width":"100px",class:"mt-4","label-position":"right","require-asterisk-position":"right"},{default:u(()=>[t(h,{label:"账户名",prop:"account"},{default:u(()=>[t(p,{modelValue:e(n).account,"onUpdate:modelValue":l[6]||(l[6]=i=>e(n).account=i),placeholder:"请输入管理员账户名称",clearable:""},null,8,["modelValue"])]),_:1}),t(h,{label:"昵称",prop:"nickname"},{default:u(()=>[t(p,{modelValue:e(n).nickname,"onUpdate:modelValue":l[7]||(l[7]=i=>e(n).nickname=i),placeholder:"请输入管理员昵称",clearable:""},null,8,["modelValue"])]),_:1}),t(h,{label:"邮箱",prop:"email"},{default:u(()=>[t(p,{modelValue:e(n).email,"onUpdate:modelValue":l[8]||(l[8]=i=>e(n).email=i),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1}),t(h,{label:"密码",prop:"password"},{default:u(()=>[t(p,{modelValue:e(n).password,"onUpdate:modelValue":l[9]||(l[9]=i=>e(n).password=i),placeholder:"请输入管理员密码",clearable:"","show-password":""},null,8,["modelValue"])]),_:1}),t(h,{label:"重复密码",prop:"re_password"},{default:u(()=>[t(p,{modelValue:e(n).re_password,"onUpdate:modelValue":l[10]||(l[10]=i=>e(n).re_password=i),placeholder:"请重复管理员密码",clearable:"","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):e(a).step===3?(c(),V("div",Te,[t(m,{class:"disib",name:"install",width:"200px",height:"200px"}),Ze])):C("",!0),y("div",Le,[e(a).step===1?(c(),$(D,{key:0,onClick:x.goPrev,plain:"",class:"w-50 mt-4",round:""},{default:u(()=>[P(" 返回上一步 ")]),_:1},8,["onClick"])):C("",!0),t(D,{onClick:x.handleNext,type:"primary",class:"w-50 mt-4",round:""},{default:u(()=>[P(U(e(a).step!==3?"下一步":"返回首页"),1)]),_:1},8,["onClick"])])]),_:1})}}});const Ge=he(Me,[["__scopeId","data-v-1bd4b242"]]);export{Ge as default};
