import{ac as ae,ad as le,v as W,x as re,m as E,u as G,F as f,G as k,I as v,n as e,q as N,P as x,H as y,Q as Z,_ as H,a7 as P,J as U,a4 as Q,ae as X,f as j,p as oe,V as Y,A as ne,l as B,C as ie,o as ue,b as de,D as S,a5 as T,L as C,K as u,M as pe,O,y as l,af as ce,ag as me,ah as ve,ai as F,aj as fe,ak as q,a9 as ge,aa as _e,ab as he}from"./index-23100cd1.js";import{f as be,C as ee,_ as we,E as ye,b as Se,d as Ve,c as ke}from"./LottieItem-d177262c.js";const Ce=(p,d,s)=>be(p.subTree).filter(a=>{var t;return le(a)&&((t=a.type)==null?void 0:t.name)===d&&!!a.component}).map(a=>a.component.uid).map(a=>s[a]).filter(a=>!!a),$e=(p,d)=>{const s={},c=ae([]);return{children:c,addChild:t=>{s[t.uid]=t,c.value=Ce(p,d,s)},removeChild:t=>{delete s[t],c.value=c.value.filter(_=>_.uid!==t)}}},xe=W({header:{type:String,default:""},bodyStyle:{type:re([String,Object,Array]),default:""},shadow:{type:String,values:["always","hover","never"],default:"always"}}),Ee=E({name:"ElCard"}),Ie=E({...Ee,props:xe,setup(p){const d=G("card");return(s,c)=>(f(),k("div",{class:v([e(d).b(),e(d).is(`${s.shadow}-shadow`)])},[s.$slots.header||s.header?(f(),k("div",{key:0,class:v(e(d).e("header"))},[N(s.$slots,"header",{},()=>[P(U(s.header),1)])],2)):x("v-if",!0),y("div",{class:v(e(d).e("body")),style:Z(s.bodyStyle)},[N(s.$slots,"default")],6)],2))}});var Ne=H(Ie,[["__file","/home/runner/work/element-plus/element-plus/packages/components/card/src/card.vue"]]);const qe=Q(Ne),Ue=W({space:{type:[Number,String],default:""},active:{type:Number,default:0},direction:{type:String,default:"horizontal",values:["horizontal","vertical"]},alignCenter:{type:Boolean},simple:{type:Boolean},finishStatus:{type:String,values:["wait","process","finish","error","success"],default:"finish"},processStatus:{type:String,values:["wait","process","finish","error","success"],default:"process"}}),Be={[ee]:(p,d)=>[p,d].every(X)},Pe=E({name:"ElSteps"}),Ae=E({...Pe,props:Ue,emits:Be,setup(p,{emit:d}){const s=p,c=G("steps"),{children:n,addChild:a,removeChild:t}=$e(Y(),"ElStep");return j(n,()=>{n.value.forEach((_,h)=>{_.setIndex(h)})}),oe("ElSteps",{props:s,steps:n,addStep:a,removeStep:t}),j(()=>s.active,(_,h)=>{d(ee,_,h)}),(_,h)=>(f(),k("div",{class:v([e(c).b(),e(c).m(_.simple?"simple":_.direction)])},[N(_.$slots,"default")],2))}});var ze=H(Ae,[["__file","/home/runner/work/element-plus/element-plus/packages/components/steps/src/steps.vue"]]);const De=W({title:{type:String,default:""},icon:{type:ne},description:{type:String,default:""},status:{type:String,values:["","wait","process","finish","error","success"],default:""}}),Re=E({name:"ElStep"}),Te=E({...Re,props:De,setup(p){const d=p,s=G("step"),c=B(-1),n=B({}),a=B(""),t=ie("ElSteps"),_=Y();ue(()=>{j([()=>t.props.active,()=>t.props.processStatus,()=>t.props.finishStatus],([o])=>{i(o)},{immediate:!0})}),de(()=>{t.removeStep(K.uid)});const h=S(()=>d.status||a.value),$=S(()=>{const o=t.steps.value[c.value-1];return o?o.currentStatus:"wait"}),b=S(()=>t.props.alignCenter),r=S(()=>t.props.direction==="vertical"),g=S(()=>t.props.simple),V=S(()=>t.steps.value.length),A=S(()=>{var o;return((o=t.steps.value[V.value-1])==null?void 0:o.uid)===(_==null?void 0:_.uid)}),m=S(()=>g.value?"":t.props.space),w=S(()=>[s.b(),s.is(g.value?"simple":t.props.direction),s.is("flex",A.value&&!m.value&&!b.value),s.is("center",b.value&&!r.value&&!g.value)]),z=S(()=>{const o={flexBasis:X(m.value)?`${m.value}px`:m.value?m.value:`${100/(V.value-(b.value?0:1))}%`};return r.value||A.value&&(o.maxWidth=`${100/V.value}%`),o}),D=o=>{c.value=o},L=o=>{const I=o==="wait",M={transitionDelay:`${I?"-":""}${150*c.value}ms`},J=o===t.props.processStatus||I?0:100;M.borderWidth=J&&!g.value?"1px":0,M[t.props.direction==="vertical"?"height":"width"]=`${J}%`,n.value=M},i=o=>{o>c.value?a.value=t.props.finishStatus:o===c.value&&$.value!=="error"?a.value=t.props.processStatus:a.value="wait";const I=t.steps.value[c.value-1];I&&I.calcProgress(a.value)},K=T({uid:_.uid,currentStatus:h,setIndex:D,calcProgress:L});return t.addStep(K),(o,I)=>(f(),k("div",{style:Z(e(z)),class:v(e(w))},[x(" icon & line "),y("div",{class:v([e(s).e("head"),e(s).is(e(h))])},[e(g)?x("v-if",!0):(f(),k("div",{key:0,class:v(e(s).e("line"))},[y("i",{class:v(e(s).e("line-inner")),style:Z(n.value)},null,6)],2)),y("div",{class:v([e(s).e("icon"),e(s).is(o.icon||o.$slots.icon?"icon":"text")])},[N(o.$slots,"icon",{},()=>[o.icon?(f(),C(e(O),{key:0,class:v(e(s).e("icon-inner"))},{default:u(()=>[(f(),C(pe(o.icon)))]),_:1},8,["class"])):e(h)==="success"?(f(),C(e(O),{key:1,class:v([e(s).e("icon-inner"),e(s).is("status")])},{default:u(()=>[l(e(ce))]),_:1},8,["class"])):e(h)==="error"?(f(),C(e(O),{key:2,class:v([e(s).e("icon-inner"),e(s).is("status")])},{default:u(()=>[l(e(me))]),_:1},8,["class"])):e(g)?x("v-if",!0):(f(),k("div",{key:3,class:v(e(s).e("icon-inner"))},U(c.value+1),3))])],2)],2),x(" title & description "),y("div",{class:v(e(s).e("main"))},[y("div",{class:v([e(s).e("title"),e(s).is(e(h))])},[N(o.$slots,"title",{},()=>[P(U(o.title),1)])],2),e(g)?(f(),k("div",{key:0,class:v(e(s).e("arrow"))},null,2)):(f(),k("div",{key:1,class:v([e(s).e("description"),e(s).is(e(h))])},[N(o.$slots,"description",{},()=>[P(U(o.description),1)])],2))],2)],6))}});var se=H(Te,[["__file","/home/runner/work/element-plus/element-plus/packages/components/steps/src/item.vue"]]);const Le=Q(ze,{Step:se}),Me=ve(se);const R=(p,d,s)=>{p.code===200?F.success(d||p.msg):F.error(s||p.msg)},te=p=>(ge("data-v-01217744"),p=p(),_e(),p),Oe={class:"card-header flex-center"},Ze=te(()=>y("h1",{class:"center"},"DoAuth域名授权管理系统",-1)),je={key:2,class:"install-success center my-4"},Fe=te(()=>y("div",{class:"w-100 center"},[y("span",null,"恭喜您，程序已安装成功！")],-1)),We={class:"flex-center px-4"},Ge=E({__name:"IndexView",setup(p){const d=B(),s=B(),c=fe(),n=T({hostname:"localhost",hostport:"3306",database:"",username:"",password:"",prefix:"auth"}),a=T({account:"admin",nickname:"管理员",email:"",password:"",re_password:""}),t=T({step:0}),_={hostname:[{required:!0,message:"数据库地址不能为空",trigger:"blur"}],hostport:[{required:!0,message:"数据库端口不能为空",trigger:"blur"}],database:[{required:!0,message:"数据库名称不能为空",trigger:"blur"}],username:[{required:!0,message:"数据库用户名不能为空",trigger:"blur"}],password:[{required:!0,message:"数据库密码不能为空",trigger:"blur"},{min:6,message:"数据库密码不能少于6位",trigger:"blur"},{max:18,message:"数据库密码不能多于18位",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"数据库密码只能包含数字字母或下划线",trigger:"blur"}],prefix:[{required:!0,message:"数据表前缀不能为空",trigger:"blur"},{pattern:/^[a-zA-Z]+$/,message:"数据表前缀只可以输入数字母",trigger:"blur"}]},h={account:[{required:!0,message:"账户名不能为空",trigger:"blur"},{min:5,message:"账户名不能少于5位",trigger:"blur"},{max:18,message:"账户名不能多于18位",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"账户名只能包含数字字母或下划线",trigger:"blur"}],nickname:[{required:!0,message:"昵称不能为空",trigger:"blur"}],email:[{required:!0,message:"邮箱不能为空",trigger:"blur"},{pattern:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,message:"邮箱格式不正确",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"},{min:6,message:"密码不能少于6位",trigger:"blur"},{max:18,message:"密码不能多于18位",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"密码只能包含数字字母或下划线",trigger:"blur"}]},$={handleNext:async()=>{t.step===0&&$.initDB(d.value),t.step===1&&$.install(s.value),t.step===3&&c.push("/")},initDB:async b=>{b&&await b.validate(async r=>{if(r){const g=await q.connect(n.hostname,n.hostport,n.database,n.username,n.password,n.prefix);if(R(g),g.code===200){const V=await q.init();R(V),t.step=1}}})},install:async b=>{b&&await b.validate(async r=>{if(r){if(a.password!==a.re_password)return F.warning("两次输入的密码不一致，请检查！");const g=await q.admin(a.account,a.nickname,a.email,a.password);R(g),g.code===200&&$.installLock()}})},installLock:async()=>{const b=await q.lock();R(b,"安装成功"),b.code===200&&(t.step=3)},goPrev:async()=>{await q.rmconfig(),t.step=0}};return(b,r)=>{const g=we,V=Me,A=Le,m=ye,w=Se,z=Ve,D=ke,L=qe;return f(),C(L,{class:"box-card p-2"},{header:u(()=>[y("div",Oe,[l(g,{name:"auth",width:"80px",height:"80px"}),Ze])]),default:u(()=>[l(A,{active:e(t).step,"finish-status":"success","align-center":""},{default:u(()=>[l(V,{title:"数据库配置"}),l(V,{title:"管理员账户"}),l(V,{title:"完成安装"})]),_:1},8,["active"]),e(t).step===0?(f(),C(z,{key:0,ref_key:"dbRef",ref:d,model:e(n),rules:_,"label-width":"110px",class:"mt-4","label-position":"right","require-asterisk-position":"right"},{default:u(()=>[l(w,{label:"数据库地址",prop:"hostname"},{default:u(()=>[l(m,{modelValue:e(n).hostname,"onUpdate:modelValue":r[0]||(r[0]=i=>e(n).hostname=i),placeholder:"请输入数据库地址",clearable:""},null,8,["modelValue"])]),_:1}),l(w,{label:"数据库端口",prop:"hostport"},{default:u(()=>[l(m,{modelValue:e(n).hostport,"onUpdate:modelValue":r[1]||(r[1]=i=>e(n).hostport=i),placeholder:"请输入数据库端口号",clearable:""},null,8,["modelValue"])]),_:1}),l(w,{label:"数据库名称",prop:"database"},{default:u(()=>[l(m,{modelValue:e(n).database,"onUpdate:modelValue":r[2]||(r[2]=i=>e(n).database=i),placeholder:"请输入数据库名称",clearable:""},null,8,["modelValue"])]),_:1}),l(w,{label:"数据库用户名",prop:"username"},{default:u(()=>[l(m,{modelValue:e(n).username,"onUpdate:modelValue":r[3]||(r[3]=i=>e(n).username=i),placeholder:"请输入数据库用户名",clearable:""},null,8,["modelValue"])]),_:1}),l(w,{label:"数据库密码",prop:"password"},{default:u(()=>[l(m,{modelValue:e(n).password,"onUpdate:modelValue":r[4]||(r[4]=i=>e(n).password=i),type:"password",placeholder:"请输入数据库密码",clearable:"","show-password":""},null,8,["modelValue"])]),_:1}),l(w,{label:"数据表前缀",prop:"prefix"},{default:u(()=>[l(m,{modelValue:e(n).prefix,"onUpdate:modelValue":r[5]||(r[5]=i=>e(n).prefix=i),placeholder:"请输入数据表前缀",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):e(t).step===1?(f(),C(z,{key:1,ref_key:"adminRef",ref:s,model:e(a),rules:h,"label-width":"100px",class:"mt-4","label-position":"right","require-asterisk-position":"right"},{default:u(()=>[l(w,{label:"账户名",prop:"account"},{default:u(()=>[l(m,{modelValue:e(a).account,"onUpdate:modelValue":r[6]||(r[6]=i=>e(a).account=i),placeholder:"请输入管理员账户名称",clearable:""},null,8,["modelValue"])]),_:1}),l(w,{label:"昵称",prop:"nickname"},{default:u(()=>[l(m,{modelValue:e(a).nickname,"onUpdate:modelValue":r[7]||(r[7]=i=>e(a).nickname=i),placeholder:"请输入管理员昵称",clearable:""},null,8,["modelValue"])]),_:1}),l(w,{label:"邮箱",prop:"email"},{default:u(()=>[l(m,{modelValue:e(a).email,"onUpdate:modelValue":r[8]||(r[8]=i=>e(a).email=i),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1}),l(w,{label:"密码",prop:"password"},{default:u(()=>[l(m,{modelValue:e(a).password,"onUpdate:modelValue":r[9]||(r[9]=i=>e(a).password=i),placeholder:"请输入管理员密码",clearable:"","show-password":""},null,8,["modelValue"])]),_:1}),l(w,{label:"重复密码",prop:"re_password"},{default:u(()=>[l(m,{modelValue:e(a).re_password,"onUpdate:modelValue":r[10]||(r[10]=i=>e(a).re_password=i),placeholder:"请重复管理员密码",clearable:"","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):e(t).step===3?(f(),k("div",je,[l(g,{class:"disib",name:"install",width:"200px",height:"200px"}),Fe])):x("",!0),y("div",We,[e(t).step===1?(f(),C(D,{key:0,onClick:$.goPrev,plain:"",class:"w-50 mt-4",round:""},{default:u(()=>[P(" 返回上一步 ")]),_:1},8,["onClick"])):x("",!0),l(D,{onClick:$.handleNext,type:"primary",class:"w-50 mt-4",round:""},{default:u(()=>[P(U(e(t).step!==3?"下一步":"返回首页"),1)]),_:1},8,["onClick"])])]),_:1})}}});const Je=he(Ge,[["__scopeId","data-v-01217744"]]);export{Je as default};
